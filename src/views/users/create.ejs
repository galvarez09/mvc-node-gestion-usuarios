<%- include('../layouts/main', { title: title }) %>

<div class="max-w-2xl mx-auto">
    <div class="bg-white shadow rounded-lg">
        <!-- Header del formulario -->
        <div class="px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">Crear Nuevo Usuario</h2>
                    <p class="text-sm text-gray-600 mt-1">Completa el formulario para crear un nuevo usuario</p>
                </div>
                <a href="/users" class="btn-secondary">
                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Volver
                </a>
            </div>
        </div>

        <!-- Formulario -->
        <form method="POST" action="/users" class="p-6 space-y-6">
            <!-- Nombre -->
            <div>
                <label for="name" class="form-label">Nombre Completo *</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    value="<%= user.name || '' %>"
                    class="form-input <%= locals.errors && errors.find(e => e.path === 'name') ? 'border-red-500 focus:ring-red-500' : '' %>"
                    placeholder="Ingresa el nombre completo"
                    required
                >
                <% if (locals.errors && errors.find(e => e.path === 'name')) { %>
                    <p class="mt-1 text-sm text-red-600">
                        <%= errors.find(e => e.path === 'name').msg %>
                    </p>
                <% } %>
            </div>

            <!-- Email -->
            <div>
                <label for="email" class="form-label">Correo Electr√≥nico *</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    value="<%= user.email || '' %>"
                    class="form-input <%= locals.errors && errors.find(e => e.path === 'email') ? 'border-red-500 focus:ring-red-500' : '' %>"
                    placeholder="usuario@ejemplo.com"
                    required
                >
                <% if (locals.errors && errors.find(e => e.path === 'email')) { %>
                    <p class="mt-1 text-sm text-red-600">
                        <%= errors.find(e => e.path === 'email').msg %>
                    </p>
                <% } %>
            </div>

            <!-- Contrase√±a -->
            <div>
                <label for="password" class="form-label">Contrase√±a *</label>
                <div class="relative">
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        class="form-input <%= locals.errors && errors.find(e => e.path === 'password') ? 'border-red-500 focus:ring-red-500' : '' %> pr-10"
                        placeholder="M√≠nimo 6 caracteres"
                        required
                        minlength="6"
                    >
                    <button 
                        type="button" 
                        onclick="togglePassword('password')"
                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                    >
                        <svg id="eye-icon-password" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                        <svg id="eye-slash-icon-password" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                        </svg>
                    </button>
                </div>
                <% if (locals.errors && errors.find(e => e.path === 'password')) { %>
                    <p class="mt-1 text-sm text-red-600">
                        <%= errors.find(e => e.path === 'password').msg %>
                    </p>
                <% } %>
                <p class="mt-1 text-sm text-gray-500">La contrase√±a debe tener al menos 6 caracteres</p>
            </div>

            <!-- Confirmar Contrase√±a -->
            <div>
                <label for="confirmPassword" class="form-label">Confirmar Contrase√±a *</label>
                <div class="relative">
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        name="confirmPassword" 
                        class="form-input pr-10"
                        placeholder="Repite la contrase√±a"
                        required
                    >
                    <button 
                        type="button" 
                        onclick="togglePassword('confirmPassword')"
                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"
                    >
                        <svg id="eye-icon-confirmPassword" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                        <svg id="eye-slash-icon-confirmPassword" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                        </svg>
                    </button>
                </div>
                <div id="password-match" class="mt-1 text-sm hidden"></div>
            </div>

            <!-- Rol -->
            <div>
                <label for="role" class="form-label">Rol del Usuario</label>
                <select 
                    id="role" 
                    name="role" 
                    class="form-input"
                >
                    <option value="user" <%= (user.role || 'user') === 'user' ? 'selected' : '' %>>üë§ Usuario</option>
                    <option value="admin" <%= user.role === 'admin' ? 'selected' : '' %>>üëë Administrador</option>
                </select>
                <p class="mt-1 text-sm text-gray-500">Los administradores tienen acceso completo al sistema</p>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                <a href="/users" class="btn-secondary">
                    Cancelar
                </a>
                <button type="submit" class="btn-primary">
                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Crear Usuario
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Funci√≥n para mostrar/ocultar contrase√±a
    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const eyeIcon = document.getElementById(`eye-icon-${fieldId}`);
        const eyeSlashIcon = document.getElementById(`eye-slash-icon-${fieldId}`);
        
        if (field.type === 'password') {
            field.type = 'text';
            eyeIcon.classList.add('hidden');
            eyeSlashIcon.classList.remove('hidden');
        } else {
            field.type = 'password';
            eyeIcon.classList.remove('hidden');
            eyeSlashIcon.classList.add('hidden');
        }
    }

    // Validaci√≥n de contrase√±as
    document.addEventListener('DOMContentLoaded', function() {
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirmPassword');
        const passwordMatch = document.getElementById('password-match');
        
        function validatePasswords() {
            if (confirmPassword.value === '') {
                passwordMatch.classList.add('hidden');
                return;
            }
            
            if (password.value === confirmPassword.value) {
                passwordMatch.textContent = '‚úÖ Las contrase√±as coinciden';
                passwordMatch.className = 'mt-1 text-sm text-green-600';
                passwordMatch.classList.remove('hidden');
            } else {
                passwordMatch.textContent = '‚ùå Las contrase√±as no coinciden';
                passwordMatch.className = 'mt-1 text-sm text-red-600';
                passwordMatch.classList.remove('hidden');
            }
        }
        
        password.addEventListener('input', validatePasswords);
        confirmPassword.addEventListener('input', validatePasswords);
        
        // Validaci√≥n del formulario antes de enviar
        document.querySelector('form').addEventListener('submit', function(e) {
            if (password.value !== confirmPassword.value) {
                e.preventDefault();
                alert('Las contrase√±as no coinciden. Por favor, verifica que ambas sean iguales.');
                return false;
            }
        });
    });
</script>
